generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String
  role          UserRole  @default(EDITOR)
  image         String?
  emailVerified DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deals         Deal[]
  reviews       Review[]
  pages         Page[]
  blogPosts     BlogPost[]

  @@map("users")
}

model Category {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?  @db.Text
  icon        String?
  image       String?
  color       String?
  dealCount   Int      @default(0)
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deals       Deal[]

  @@map("categories")
}

model Deal {
  id              String       @id @default(cuid())
  title           String
  slug            String       @unique
  description     String       @db.Text
  shortDesc       String?      @db.Text
  currentPrice    Decimal      @db.Decimal(10, 2)
  originalPrice   Decimal?     @db.Decimal(10, 2)
  discount        Int?
  currency        String       @default("INR")
  rating          Decimal?     @db.Decimal(2, 1)
  reviewCount     Int?
  features        String?      @db.Text
  images          String       @db.Text
  primaryImage    String?      @db.LongText
  coupon          String?      @db.Text
  isLoot          Boolean      @default(false)
  productUrl      String
  affiliateUrl    String?
  categoryId      String
  tags            String?      @db.Text
  status          DealStatus   @default(DRAFT)
  badge           String?
  isFeatured      Boolean      @default(false)
  isExpired       Boolean      @default(false)
  expiresAt       DateTime?
  metaTitle       String?
  metaDescription String?      @db.Text
  views           Int          @default(0)
  clicks          Int          @default(0)
  authorId        String
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  publishedAt     DateTime?
  clickEvents     ClickEvent[]
  author          User         @relation(fields: [authorId], references: [id])
  category        Category     @relation(fields: [categoryId], references: [id])
  amazonProduct   AmazonProduct?
  hotDeal         HotDeal?

  @@index([categoryId])
  @@index([status])
  @@index([slug])
  @@index([authorId], map: "deals_authorId_fkey")
  @@map("deals")
}

model Review {
  id              String       @id @default(cuid())
  title           String
  slug            String       @unique
  excerpt         String       @db.Text
  content         String       @db.Text
  coverImage      String
  images          String?      @db.Text
  categoryName    String?
  readTime        Int?
  products        String?      @db.Text
  metaTitle       String?
  metaDescription String?      @db.Text
  status          ReviewStatus @default(DRAFT)
  isFeatured      Boolean      @default(false)
  views           Int          @default(0)
  authorId        String
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  publishedAt     DateTime?
  author          User         @relation(fields: [authorId], references: [id])

  @@index([status])
  @@index([slug])
  @@index([authorId], map: "reviews_authorId_fkey")
  @@map("reviews")
}

model AffiliateNetwork {
  id           String       @id @default(cuid())
  name         String
  slug         String       @unique
  type         String?
  apiKey       String?      @db.Text
  apiSecret    String?      @db.Text
  publisherId  String?
  trackingId   String?
  baseUrl      String?
  linkFormat   String?      @db.Text
  customParams String?      @db.Text
  isActive     Boolean      @default(true)
  isDefault    Boolean      @default(false)
  priority     Int          @default(0)
  commission   Decimal?     @db.Decimal(5, 2)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  clickEvents  ClickEvent[]

  @@map("affiliate_networks")
}

model ClickEvent {
  id              String            @id @default(cuid())
  dealId          String?
  networkId       String?
  url             String            @db.Text
  userAgent       String?           @db.Text
  ip              String?
  country         String?
  city            String?
  referrer        String?           @db.Text
  converted       Boolean           @default(false)
  conversionValue Decimal?          @db.Decimal(10, 2)
  conversionDate  DateTime?
  clickedAt       DateTime          @default(now())
  deal            Deal?             @relation(fields: [dealId], references: [id])
  network         AffiliateNetwork? @relation(fields: [networkId], references: [id])

  @@index([dealId])
  @@index([networkId])
  @@index([clickedAt])
  @@map("click_events")
}

model Subscriber {
  id             String           @id @default(cuid())
  email          String           @unique
  name           String?
  status         SubscriberStatus @default(ACTIVE)
  subscribedAt   DateTime         @default(now())
  unsubscribedAt DateTime?
  preferences    String?          @db.Text

  @@map("subscribers")
}

model Setting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String   @db.Text
  description String?  @db.Text
  updatedAt   DateTime @updatedAt

  @@map("settings")
}

enum UserRole {
  ADMIN
  EDITOR
  VIEWER
}

enum DealStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ReviewStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum SubscriberStatus {
  ACTIVE
  UNSUBSCRIBED
  BOUNCED
}

// =====================================================
// DYNAMIC PAGES MANAGEMENT
// =====================================================

model Page {
  id              String      @id @default(cuid())
  title           String
  slug            String      @unique
  excerpt         String?     @db.Text
  content         String?     @db.LongText
  
  // SEO Fields
  metaTitle       String?
  metaDescription String?     @db.Text
  metaKeywords    String?     @db.Text
  ogImage         String?
  
  // Media
  featuredImage   String?
  
  // Status & Publishing
  status          PageStatus  @default(DRAFT)
  publishedAt     DateTime?
  
  // Ordering
  order           Int         @default(0)
  
  // Template Selection
  template        PageTemplate @default(DEFAULT)
  
  // Relationships
  authorId        String?
  author          User?       @relation(fields: [authorId], references: [id])
  
  // Sections for page builder
  sections        PageSection[]
  
  // Timestamps
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([slug])
  @@index([status])
  @@map("pages")
}

enum PageStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum PageTemplate {
  DEFAULT
  LANDING
  BLOG_LIST
  BLOG_POST
  FEATURES
  ABOUT
  CONTACT
  LOOT_DEALS
  COUPON
  TELEGRAM
}

model PageSection {
  id              String        @id @default(cuid())
  pageId          String
  page            Page          @relation(fields: [pageId], references: [id], onDelete: Cascade)
  
  sectionType     SectionType
  title           String?
  content         String?       @db.LongText
  data            String?       @db.Text
  
  // Styling
  backgroundColor String?
  textColor       String?
  padding         String?
  
  // Ordering
  order           Int           @default(0)
  
  // Visibility
  isActive        Boolean       @default(true)
  
  // Timestamps
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@index([pageId])
  @@map("page_sections")
}

enum SectionType {
  HERO
  FEATURES_GRID
  TESTIMONIALS
  CTA
  CONTENT_BLOCK
  IMAGE_GALLERY
  FAQ
  PRICING
  TEAM
  STATS
  CUSTOM_HTML
  BLOG_POSTS
  DEALS_GRID
  COUPONS_GRID
  TELEGRAM_JOIN
  CONTACT_FORM
}

// =====================================================
// BLOG MANAGEMENT
// =====================================================

model BlogCategory {
  id          String      @id @default(cuid())
  name        String
  slug        String      @unique
  description String?     @db.Text
  image       String?
  
  order       Int         @default(0)
  isActive    Boolean     @default(true)
  
  metaTitle   String?
  metaDescription String? @db.Text
  
  posts       BlogPost[]
  
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  @@index([slug])
  @@map("blog_categories")
}

model BlogPost {
  id              String          @id @default(cuid())
  title           String
  slug            String          @unique
  excerpt         String?         @db.Text
  content         String          @db.LongText
  
  featuredImage   String?
  images          String?         @db.Text
  
  categoryId      String?
  category        BlogCategory?   @relation(fields: [categoryId], references: [id])
  tags            String?         @db.Text
  
  authorName      String?
  authorImage     String?
  
  readTime        Int?
  
  metaTitle       String?
  metaDescription String?         @db.Text
  metaKeywords    String?         @db.Text
  ogImage         String?
  
  status          BlogStatus      @default(DRAFT)
  isFeatured      Boolean         @default(false)
  isSticky        Boolean         @default(false)
  
  publishedAt     DateTime?
  scheduledAt     DateTime?
  
  views           Int             @default(0)
  
  authorId        String?
  author          User?           @relation(fields: [authorId], references: [id])
  
  relatedPosts    BlogPostRelated[] @relation("RelatedPost")
  relatedTo       BlogPostRelated[] @relation("MainPost")
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@index([slug])
  @@index([status])
  @@index([categoryId])
  @@index([publishedAt])
  @@map("blog_posts")
}

model BlogPostRelated {
  id              String    @id @default(cuid())
  mainPostId      String
  mainPost        BlogPost  @relation("MainPost", fields: [mainPostId], references: [id], onDelete: Cascade)
  relatedPostId   String
  relatedPost     BlogPost  @relation("RelatedPost", fields: [relatedPostId], references: [id], onDelete: Cascade)
  order           Int       @default(0)
  
  @@unique([mainPostId, relatedPostId])
  @@map("blog_post_related")
}

enum BlogStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

// =====================================================
// FEATURES MANAGEMENT
// =====================================================

model Feature {
  id              String    @id @default(cuid())
  title           String
  description     String    @db.Text
  
  icon            String?
  image           String?
  
  linkUrl         String?
  linkText        String?
  
  order           Int       @default(0)
  isActive        Boolean   @default(true)
  isFeatured      Boolean   @default(false)
  
  color           String?
  backgroundColor String?
  
  featureGroupId  String?
  featureGroup    FeatureGroup? @relation(fields: [featureGroupId], references: [id])
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([order])
  @@index([isActive])
  @@map("features")
}

model FeatureGroup {
  id              String    @id @default(cuid())
  title           String
  description     String?   @db.Text
  
  order           Int       @default(0)
  isActive        Boolean   @default(true)
  
  layout          FeatureLayout @default(GRID)
  
  features        Feature[]
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@map("feature_groups")
}

enum FeatureLayout {
  GRID
  LIST
  CARDS
  ICONS
  HORIZONTAL_SCROLL
}

// =====================================================
// ABOUT PAGE SECTIONS
// =====================================================

model AboutSection {
  id              String        @id @default(cuid())
  sectionKey      String        @unique
  title           String
  content         String?       @db.LongText
  
  image           String?
  imagePosition   ImagePosition @default(RIGHT)
  
  order           Int           @default(0)
  isActive        Boolean       @default(true)
  
  metaTitle       String?
  metaDescription String?       @db.Text
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@map("about_sections")
}

enum ImagePosition {
  LEFT
  RIGHT
  TOP
  BOTTOM
  BACKGROUND
}

model TeamMember {
  id              String    @id @default(cuid())
  name            String
  role            String
  bio             String?   @db.Text
  
  image           String?
  socialLinks     String?   @db.Text
  
  order           Int       @default(0)
  isActive        Boolean   @default(true)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@map("team_members")
}

model Testimonial {
  id              String    @id @default(cuid())
  quote           String    @db.Text
  authorName      String
  authorRole      String?
  authorImage     String?
  company         String?
  rating          Int?
  
  order           Int       @default(0)
  isActive        Boolean   @default(true)
  isFeatured      Boolean   @default(false)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@map("testimonials")
}

// =====================================================
// AMAZON API CONFIGURATION
// =====================================================

model AmazonConfig {
  id            String    @id @default(cuid())
  associateTag  String
  accessKey     String?   @db.Text
  secretKey     String?   @db.Text
  region        String    @default("in")
  marketplace   String    @default("IN")
  isActive      Boolean   @default(true)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("amazon_config")
}

// =====================================================
// AMAZON PRODUCTS CACHE
// =====================================================

model AmazonProduct {
  asin           String    @id
  title          String
  description    String?   @db.Text
  currentPrice   Decimal?  @db.Decimal(10, 2)
  originalPrice  Decimal?  @db.Decimal(10, 2)
  currency       String    @default("INR")
  imageUrl       String?   @db.Text
  productUrl     String?   @db.Text
  
  // Relationship to Deal
  dealId         String?     @unique
  deal           Deal?     @relation(fields: [dealId], references: [id])
  
  // Tracking
  lastCheckedAt  DateTime?
  
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  
  @@index([dealId])
  @@map("amazon_products")
}

// =====================================================
// API CONNECTION LOGS
// =====================================================

model ApiConnectionLog {
  id          String    @id @default(cuid())
  networkId   String
  type        String    // AMAZON, TELEGRAM, etc.
  action      String    // SYNC, NOTIFICATION, IMPORT, etc.
  status      String    // SUCCESS, FAILED, PARTIAL
  message     String?   @db.Text
  
  createdAt   DateTime  @default(now())
  
  @@index([networkId])
  @@index([type])
  @@index([action])
  @@index([createdAt])
  @@map("api_connection_logs")
}

// =====================================================
// TELEGRAM BOT CONFIGURATION
// =====================================================

model TelegramBot {
  id            String              @id @default(cuid())
  name          String?
  botToken      String
  webhookUrl    String?
  chatId        String?
  isActive      Boolean             @default(true)
  
  notifications TelegramNotification[]
  
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  
  @@map("telegram_bots")
}

model TelegramNotification {
  id              String          @id @default(cuid())
  botId           String
  bot             TelegramBot     @relation(fields: [botId], references: [id], onDelete: Cascade)
  
  type            NotificationType
  messageTemplate String?         @db.Text
  isEnabled       Boolean         @default(true)
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  
  @@unique([botId, type])
  @@index([botId])
  @@map("telegram_notifications")
}

enum NotificationType {
  NEW_DEAL
  PRICE_DROP
  DAILY_DIGEST
  EXPIRY_WARNING
}

// =====================================================
// COUPON CODES MANAGEMENT
// =====================================================

model CouponCode {
  id              String        @id @default(cuid())
  code            String        @unique
  description     String?       @db.Text
  discountType    DiscountType  @default(PERCENTAGE)
  discountValue   Decimal       @db.Decimal(10, 2)
  
  expiryDate      DateTime?
  isActive        Boolean       @default(true)
  
  minPurchase     Decimal?      @db.Decimal(10, 2)
  maxDiscount     Decimal?      @db.Decimal(10, 2)
  
  usageLimit      Int?
  usageCount      Int           @default(0)
  
  applicableCategories String?   @db.Text
  applicableDeals      String?   @db.Text
  
  // SEO & Display
  metaTitle       String?
  metaDescription String?       @db.Text
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  @@index([isActive])
  @@index([expiryDate])
  @@map("coupon_codes")
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

// =====================================================
// BANNERS MANAGEMENT
// =====================================================

model Banner {
  id              String      @id @default(cuid())
  imageUrl        String      @db.Text
  
  title           String?
  subtitle        String?     @db.Text
  
  link            String?
  linkText        String?
  
  position        Int         @default(0)
  isActive        Boolean     @default(true)
  
  startDate       DateTime?
  endDate         DateTime?
  
  // Styling
  backgroundColor String?
  textColor       String?
  
  // Mobile
  mobileImageUrl  String?     @db.Text
  
  // Click tracking
  clicks          Int         @default(0)
  
  // Banner Type: 'slider' for content overlay, 'full-width' for image only
  bannerType      String      @default("slider")
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([isActive])
  @@index([position])
  @@index([startDate, endDate])
  @@map("banners")
}

// =====================================================
// HOT DEALS MANAGEMENT
// =====================================================

model HotDeal {
  id              String    @id @default(cuid())
  dealId          String    @unique
  deal            Deal      @relation(fields: [dealId], references: [id], onDelete: Cascade)
  
  order           Int       @default(0)
  isActive        Boolean   @default(true)
  
  // Customization
  customTitle     String?
  customBadge     String?
  
  // Scheduling
  startDate       DateTime?
  endDate         DateTime?
  
  // Display settings
  showOnHomepage  Boolean   @default(true)
  showOnLootPage  Boolean   @default(true)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([order])
  @@index([isActive])
  @@index([startDate, endDate])
  @@map("hot_deals")
}
